<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <title>yolo_socket可视化</title>
    <link rel="icon" type="image/png" sizes="144x144" href="https://files.catbox.moe/sybthq.png" />
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>
</head>

<body onload="WebSocketTest()">
    <div id="main" style="height: 450px;width: 100%;">
    </div>
    <div id="sub" style="height: 340px;width: 80%;margin: 0 auto;">

    </div>
</body>
<script type="text/javascript">
    var chartDom = document.getElementById('main');
    var chartDom2 = document.getElementById('sub');
    var myChart = echarts.init(chartDom);
    var myChart2 = echarts.init(chartDom2);
    var option1;
    var option2;
    var pie_data = []
    function update_option(pie_list, hill_list) {
        option1 = {
            title: {
                text: 'YOLO_real-time_物体所拥有的数量',
                left: 'center'
            },
            tooltip: {
                trigger: 'item'
            },
            legend: {
                top: '5%',
                left: 'center'
            },

            series: [
                {
                    name: 'yolo',
                    type: 'pie',
                    radius: ['20%', '70%'],
                    avoidLabelOverlap: false,
                    label: {
                        show: false,
                        position: 'center'
                    },
                    emphasis: {
                        label: {
                            show: true,
                            fontSize: '20',
                            fontWeight: 'bold',
                            color: '#e54035'
                        }
                    },
                    labelLine: {
                        show: false
                    },
                    data: pie_list
                }
            ]
        };
        option2 = {
            title: {
                text: 'YOLO_real-time_各物体识别精确度',
                left: 'center'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'none'
                },
                formatter: function (params) {
                    return params[0].name + ': ' + params[0].value;
                }
            },
            xAxis: {
                data: hill_list[0],
                axisTick: { show: false },
                axisLine: { show: false },
                axisLabel: {
                    color: '#e54035'
                }
            },
            grid: {
                show: true,
                left: '-1%',
                right: '-1%',
                borderColor: '#9BCD9B'
            },
            yAxis: {
                splitLine: { show: false },
                axisTick: { show: false },
                axisLine: { show: false },
                axisLabel: { show: false }
            },
            color: ['#e54035'],
            series: [
                {
                    name: 'yolo',
                    type: 'pictorialBar',
                    barCategoryGap: '-130%',
                    symbol: 'path://M0,10 L10,10 C5.5,10 5.5,5 5,0 C4.5,5 4.5,10 0,10 z',
                    itemStyle: {
                        opacity: 0.5
                    },
                    emphasis: {
                        itemStyle: {
                            opacity: 1
                        }
                    },
                    data: hill_list[1],
                    z: 10
                },
                {
                    name: 'glyph',
                    type: 'pictorialBar',
                    barGap: '-100%',
                    symbolPosition: 'end',
                    symbolSize: 50,
                    symbolOffset: [0, '-120%']
                }
            ]
        };

        option1 && myChart.setOption(option1);
        option2 && myChart2.setOption(option2);

    }
    function create_sub_div(gauge_data) {
        for (i = 0; i < gauge_data.length; i++) {
            $("<div class='one' id='sub" + i + "'></div>").appendTo($(".sub"));
        }
    }
    function WebSocketTest() {
        if ("WebSocket" in window) {
            var ws = new WebSocket("ws://127.0.0.1:8765");
            ws.onopen = function () {
                ws.send("Hello world!");
            };
            ws.onmessage = function (evt) {
                pie_data = JSON.parse(evt.data).data_pie
                gauge_data = JSON.parse(evt.data).data_gauge
                if (pie_data.length <= 0) {
                    pie_data = [null]
                    gauge_data = []
                    console.log('无数据')
                }
                update_option(pie_data, gauge_data)
            };
            ws.onclose = function () {
            };
        } else {
            alert("您的浏览器不支持 WebSocket!");
        }
    }


</script>
<style>
    body {
        background-color: #FAF0E6
    }
</style>

</html>